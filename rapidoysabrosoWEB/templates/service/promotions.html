<head>
    <title>Promociones</title>
    <!-- Añadir jQuery desde una CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<h1>Promociones</h1>

<div id="menu-container">
    <p>Cargando menús...</p>  <!-- Mensaje mientras se cargan los datos -->
    {% csrf_token %}

</div>

<!-- Script para manejar la solicitud AJAX -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        alert('conectado');

        // Obtener el token CSRF desde las cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        $.ajax({
            url: "/menus/",
            type: "GET",
            headers: { "X-CSRFToken": csrftoken },
            success: function(response) {
                $("#menu-container").html('');  // Limpia el contenedor

                // Procesa los menús devueltos por el servidor
                if (response.menus && response.menus.length > 0) {
                    let htmlContent = '<ul>';
                    response.menus.forEach(menu => {
                        htmlContent += `<li>
                            <strong>Restaurante:</strong> ${menu.restaurant}<br>
                            <strong>Promoción:</strong> ${menu.promo}<br>
                            <strong>Detalles:</strong>
                            <ul>`;
                        menu.details.forEach(detail => {
                            htmlContent += `<li>
                                <strong>Descripción:</strong> ${detail.description}<br>
                                <strong>Precio:</strong> ${detail.price}<br>
                            </li>`;
                        });
                        htmlContent += '</ul></li>';
                    });
                    htmlContent += '</ul>';
                    $("#menu-container").append(htmlContent);
                } else {
                    $("#menu-container").append('<p>No se encontraron menús disponibles.</p>');
                }
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
                $("#menu-container").html('<p>Error al cargar los menús.</p>');
            }
        });

    });
</script>
