{% extends 'service/baseplantillaNav.html' %}
{% load static %}

{% block title %}Menú - RapidoYSabroso{% endblock %}

{% block content %}

<section class="marcas-container container">
  <h2 class="text-center my-4">Marcas Disponibles</h2>
  <div id="marcaCarrusel" class="marca-cards-container d-flex overflow-auto" >
    <!-- Contenedor de las cartas en fila -->
    <div class="marca-cards-inner d-flex" >
      {% for marca in marcas %} 
      <a href="{% url 'marca' marca=marca.id %}" style="background-color:black;" class="marca-card text-center mx-3 p-3">
        <div class="">
          <!-- Aquí se sigue mostrando la imagen que proviene de la URL -->
          <img class="img-fluid marca-logo" src="{{ marca.logo_url }}" alt="{{ marca.nombre }}">
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</section>




<script src="{% static 'app/js/menu.js' %}"></script>

<div class="container">
  <div class="row">
    <!-- Filtros a la izquierda -->
    <aside class="col-md-3">
      <h5>Buscar Producto</h5>
      <input type="text" class="form-control" id="busqueda-producto" placeholder="Buscar por nombre" oninput="filtrarProductos()">
      
      <h5>Filtrar por Precio</h5>
      <input type="text" class="form-control" id="precio-minimo" placeholder="Precio Mínimo" oninput="filtrarProductos()">
      <input type="text" class="form-control" id="precio-maximo" placeholder="Precio Máximo" oninput="filtrarProductos()">
    </aside>

    <!-- Productos a la derecha -->
    <section class="col-md-9 productos-container" id="productos-container">
      {% for producto in productos %}
      <div class="producto-card">
        <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}" class="producto-imagen">
        <div class="producto-info">
          <h4 class="producto-nombre">{{ producto.nombre }}</h4>
          <p class="producto-descripcion">{{ producto.descripcion }}</p>
          <span class="producto-precio">{{ producto.precio }}</span> <!-- Incluyendo símbolo $ -->
          <span class="producto-marca">{{ producto.marca }}</span>
          <a href="{% url 'producto' id=producto.id %}">Ver detalles</a>
          <form action="{% url 'agregar_a_orden' producto.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="boton-agregar-carrito">Agregar al carrito</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </section>
  </div>
</div>

<script>
function filtrarProductos() {
    const busquedaTexto = document.getElementById('busqueda-producto').value.toLowerCase(); // Obtener texto de búsqueda
    const precioMinimo = parseFloat(document.getElementById('precio-minimo').value.replace(',', '.')) || 0; // Obtener precio mínimo
    const precioMaximo = parseFloat(document.getElementById('precio-maximo').value.replace(',', '.')) || Infinity; // Obtener precio máximo
    const productos = document.querySelectorAll('.producto-card'); // Seleccionar todos los productos

    productos.forEach(producto => {
        // Obtener el nombre del producto y la descripción
        const nombreProducto = producto.querySelector('.producto-nombre').innerText.toLowerCase();
        const descripcionProducto = producto.querySelector('.producto-descripcion').innerText.toLowerCase();
        
        // Obtener el precio del producto y limpiarlo del símbolo $ y comas
        const precioTexto = producto.querySelector('.producto-precio').innerText.replace('$', '').replace('.', '').replace(',', '.').trim(); // Reemplaza . y , adecuadamente
        const precioProducto = parseFloat(precioTexto) || 0;

        // Comprobar si el texto de búsqueda está en el nombre o descripción del producto
        const coincideBusqueda = nombreProducto.includes(busquedaTexto) || descripcionProducto.includes(busquedaTexto);
        const dentroRangoPrecio = precioProducto >= precioMinimo && precioProducto <= precioMaximo;

        // Mostrar producto si coincide con el texto de búsqueda y está dentro del rango de precios
        if (coincideBusqueda && dentroRangoPrecio) {
            producto.style.display = ''; // Mostrar producto
        } else {
            producto.style.display = 'none'; // Ocultar producto
        }
    });
}

</script>

{% endblock %}
